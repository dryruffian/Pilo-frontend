import{j as e,B as t}from"./scanner-lib-CQfekM2j.js";import{a,u as s}from"./react-core-DFLHlFU9.js";import{u as r}from"../index-BW18VAUN.js";import{X as i,C as c,S as l}from"./ui-components-btR2HY2Q.js";import"./state-management-DognVqiI.js";import"./http-client-BCtBl4R5.js";function o(){const[o,n]=a.useState(!1),[d,m]=a.useState(null),[x,u]=a.useState(!1),h=s(),{authenticatedRequest:b}=r();a.useEffect((()=>{(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});u(!0),n(!0),e.getTracks().forEach((e=>e.stop()))}catch(e){m("Camera permission is required to scan barcodes."),u(!1)}})()}),[]);const p=a.useCallback((async e=>{try{await b("get",`/api/v1/barcode/${e}`),await b("post","/data/history/add",{productCode:e}),h(`/product/${e}`)}catch(t){if(t.response)switch(t.response.status){case 400:m("Invalid barcode format");break;case 404:m("Product not found");break;case 503:m("Service temporarily unavailable");break;default:m("Failed to fetch product information")}else t.request?m("Network error - please check your connection"):m("An unexpected error occurred")}}),[b,h]);return e.jsxs("div",{className:"fixed inset-0 bg-black flex flex-col",children:[e.jsxs("div",{className:"relative bg-yellow-50 p-4 flex justify-between items-center border-b-2 border-black",children:[e.jsx("button",{onClick:()=>h("/"),className:"p-2 hover:bg-yellow-100 rounded-full active:opacity-60 transition-opacity",children:e.jsx(i,{className:"w-6 h-6"})}),e.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-bold",children:"Scan Product"})]}),e.jsx("div",{className:"flex-1 relative",children:x?o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(t,{width:window.innerWidth,height:window.innerHeight,onUpdate:(e,t)=>{t&&(n(!1),p(t.text))},className:"object-cover",onError:e=>{m("Failed to initialize scanner. Please try again."),n(!1)},torch:!1})}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 border-2 border-yellow-50 rounded-2xl",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(l,{className:"w-12 h-12 text-yellow-50"})})}),e.jsx("div",{className:"absolute bottom-[120px] left-0 right-0 text-center",children:e.jsx("p",{className:"text-yellow-50 text-sm font-medium px-4",children:"Center the barcode within the frame"})})]})]}):e.jsx("div",{className:"flex-1 bg-yellow-50 overflow-auto",children:e.jsx("div",{className:"max-w-lg mx-auto p-4",children:e.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg mb-4",children:[e.jsx("p",{className:"font-medium",children:"Error"}),e.jsx("p",{children:d}),e.jsx("button",{onClick:()=>{n(!0),m(null)},className:"mt-4 w-full bg-red-100 text-red-700 py-2 px-4 rounded-lg font-medium active:opacity-60 transition-opacity",children:"Try Again"})]})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-yellow-50 p-4",children:[e.jsx(c,{className:"w-16 h-16 mb-4 text-gray-400"}),e.jsx("p",{className:"text-center mb-4",children:d||"Camera permission is required to scan barcodes."}),e.jsx("button",{onClick:async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0}),u(!0),n(!0),m(null)}catch(e){m("Failed to access camera. Please check your browser settings."),u(!1)}},className:"bg-black text-yellow-50 py-3 px-6 rounded-xl font-medium active:opacity-60 transition-opacity",children:"Enable Camera"})]})}),e.jsx("div",{className:"h-[env(safe-area-inset-bottom)] bg-black"})]})}export{o as default};
