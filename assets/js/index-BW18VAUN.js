const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/chunks/Scanner-BUKAGjX9.js","assets/js/chunks/scanner-lib-CQfekM2j.js","assets/js/chunks/react-core-DFLHlFU9.js","assets/js/chunks/ui-components-btR2HY2Q.js","assets/js/chunks/state-management-DognVqiI.js","assets/js/chunks/http-client-BCtBl4R5.js","assets/js/chunks/Product-Ci9BZqR4.js","assets/js/chunks/ProductPage-CfTKy3RC.js","assets/js/chunks/Signup-lsJYw21Q.js","assets/js/chunks/Login-B6bDytvJ.js","assets/js/chunks/Navbar-DidKQWQq.js"])))=>i.map(i=>d[i]);
import{j as e}from"./chunks/scanner-lib-CQfekM2j.js";import{b as t,a as r,B as s,d as n,e as o}from"./chunks/react-core-DFLHlFU9.js";import{R as a}from"./chunks/state-management-DognVqiI.js";import{a as c}from"./chunks/http-client-BCtBl4R5.js";var l;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i=t;l=i.createRoot,i.hydrateRoot;const u={},d=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in u)return;u[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,r&&n.setAttribute("nonce",r),document.head.appendChild(n),t?new Promise(((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)}))},m=c.create({baseURL:"https://api.pilo.life/",headers:{"Content-Type":"application/json",Accept:"application/json"}});m.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e}),(e=>Promise.reject(e))),m.interceptors.response.use((e=>e),(async e=>{var t;return 401===(null==(t=e.response)?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}));const h=r.createContext(null),p="token",f="user",g=({children:t})=>{const[s,n]=r.useState((()=>{const e=localStorage.getItem(f);return e?JSON.parse(e):null})),[o,a]=r.useState(!0),[c,l]=r.useState(null),i=r.useCallback((()=>{localStorage.removeItem(p),localStorage.removeItem(f),delete m.defaults.headers.common.Authorization,n(null),l(null)}),[]),u=r.useCallback((async()=>{try{const e=localStorage.getItem(p);if(!e)return void a(!1);m.defaults.headers.common.Authorization=e;const t=await m.get("/auth/me");if("success"===t.data.status){const e=t.data.data.user;n(e),localStorage.setItem(f,JSON.stringify(e))}else i()}catch(e){i()}finally{a(!1)}}),[i]);r.useEffect((()=>{u()}),[u]);const d={user:s,loading:o,error:c,isAuthenticated:!!s,login:async e=>{var t,r;try{l(null);const t=await m.post("/auth/login",e);if("success"===t.data.status){const{token:e,user:r}=t.data.data,s=`Bearer ${e}`;return localStorage.setItem(p,s),localStorage.setItem(f,JSON.stringify(r)),m.defaults.headers.common.Authorization=s,n(r),{success:!0}}const r=t.data.message||"Login failed";return l(r),{success:!1,error:r}}catch(s){const e=(null==(r=null==(t=s.response)?void 0:t.data)?void 0:r.message)||"An error occurred during login";return l(e),{success:!1,error:e}}},logout:r.useCallback((async()=>{try{await m.post("/auth/logout").catch((()=>{}))}finally{i()}}),[i]),updateUser:r.useCallback((async e=>{var t,r;try{const t=await m.put("/auth/me",e);if("success"===t.data.status){const e=t.data.data.user;return n(e),localStorage.setItem(f,JSON.stringify(e)),{success:!0}}return{success:!1,error:t.data.message}}catch(s){return{success:!1,error:(null==(r=null==(t=s.response)?void 0:t.data)?void 0:r.message)||"Failed to update user"}}}),[]),authenticatedRequest:r.useCallback((async(e,t,r=null)=>{var s;try{const s=localStorage.getItem(p);if(!s)throw new Error("No authentication token found");const n=await m({method:e,url:t,...r&&{data:r},headers:{Authorization:s}}),o=n.headers["x-new-token"];return o&&(localStorage.setItem(p,o),m.defaults.headers.common.Authorization=o),n.data}catch(n){if(401===(null==(s=n.response)?void 0:s.status))throw i(),new Error("Session expired. Please login again.");throw n}}),[i]),refreshAuth:u};return e.jsx(h.Provider,{value:d,children:!o&&t})},y=()=>{const e=r.useContext(h);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},j=r.lazy((()=>d((()=>import("./chunks/Scanner-BUKAGjX9.js")),__vite__mapDeps([0,1,2,3,4,5])))),x=r.lazy((()=>d((()=>import("./chunks/Product-Ci9BZqR4.js")),__vite__mapDeps([6,1,2])))),v=r.lazy((()=>d((()=>import("./chunks/ProductPage-CfTKy3RC.js")),__vite__mapDeps([7,1,2,3,4,5])))),S=r.lazy((()=>d((()=>import("./chunks/Signup-lsJYw21Q.js")),__vite__mapDeps([8,1,2,5])))),_=r.lazy((()=>d((()=>import("./chunks/Login-B6bDytvJ.js")),__vite__mapDeps([9,1,2,3,4,5])))),k=r.lazy((()=>d((()=>import("./chunks/Navbar-DidKQWQq.js")),__vite__mapDeps([10,1,2,3])))),E=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 to-green-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})});function w(){return e.jsx(g,{children:e.jsx(a,{children:e.jsx("div",{className:"h-screen flex flex-col items-center space-y-5 py-2 px-4",children:e.jsx(s,{children:e.jsxs(r.Suspense,{fallback:e.jsx(E,{}),children:[e.jsxs(n,{children:[e.jsx(o,{path:"/login",element:e.jsx(_,{})}),e.jsx(o,{path:"/signup",element:e.jsx(S,{})}),e.jsxs(o,{element:e.jsx(ProtectedRoute,{}),children:[e.jsx(o,{path:"/",element:e.jsx(x,{})}),e.jsx(o,{path:"/scan",element:e.jsx(j,{})}),e.jsx(o,{path:"/product/:id",element:e.jsx(v,{})}),e.jsx(o,{path:"/page",element:e.jsx(x,{})})]})]}),e.jsx(k,{})]})})})})})}l(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(w,{})}));export{y as u};
